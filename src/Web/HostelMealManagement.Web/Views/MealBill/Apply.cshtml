@using HostelMealManagement.Core.Entities
@inject HostelMealManagement.Infrastructure.Helper.Acls.ISignInHelper SignInHelper
@model IEnumerable<MealBill>

@{
    Layout = null;

    decimal totalBazar = 0;
    decimal totalMealAmount = 0;
    decimal totalHouseBill = 0;
    decimal totalCurrentBill = 0;
    decimal totalGasBill = 0;
    decimal totalServantBill = 0;
    decimal totalOtherBill = 0;
    decimal grandTotalPayable = 0;

    int totalMember = Model.Count();
}

<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>Meal Bill Report</title>

    <style>
        body {
            background: #ffffff;
            font-family: "Segoe UI", sans-serif;
            padding: 20px;
        }

        .table {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 12px;
            overflow: hidden;
            border: 1px solid #d7dce3;
            box-shadow: 0 8px 25px rgba(0,0,0,0.06);
        }

        .custom-header th {
            background: linear-gradient(135deg, #21479b, #265caa);
            color: #ffffff;
            font-weight: 600;
            text-align: center;
            padding: 12px;
            font-size: 14px;
            white-space: nowrap;
            border: none;
        }

        .table td {
            vertical-align: middle;
            padding: 10px;
            font-size: 14px;
            text-align: center;
            color: #2b3340;
            white-space: nowrap;
        }

        .table tbody tr:hover {
            background-color: #f1f5ff;
        }

        tfoot td {
            font-weight: 700;
            background: #f8f9fc;
            border-top: 2px solid #cfd6e0;
        }
    </style>
</head>

<body>

<div class="table-responsive">
    <table class="table table-bordered table-striped">
        <thead class="custom-header">
        <tr>
            <th>Member Name</th>
            <th>Card No</th>
            <th>Total Bazar</th>
            <th>Member Meal</th>
            <th>Guest Meal</th>
            <th>Total Meal</th>
            <th>Meal Rate</th>
            <th>Meal Amount</th>
            <th>House Bill</th>
            <th>Electric Bill</th>
            <th>Gas Bill</th>
            <th>Servant Bill</th>
            <th>Other Bill</th>
            <th>Total Paid Amount</th>
            <th>Total Payable</th>
            <th>Total Due Amount</th>
            <th>Status</th>
            @if (User.IsInRole("Member"))
            {
                <th>Action</th>
            }
        </tr>
        </thead>

        <tbody>
        @foreach (var bill in Model)
        {
            totalBazar += bill.TotalBazar;
            totalMealAmount += bill.MealAmount;
            totalHouseBill += bill.HouseBill;
            totalCurrentBill += bill.CurrentBill;
            totalGasBill += bill.GasBill;
            totalServantBill += bill.ServantBill;
            totalOtherBill += bill.OtherBill;
            grandTotalPayable += bill.TotalPayable;

            <tr>
                <td><strong>@bill.Member?.Name</strong></td>
                <td>@bill.Member?.MemberCode</td>
                <td>@bill.TotalBazar.ToString("0.00")</td>
                <td>@bill.TotalMemberMeal</td>
                <td>@bill.TotalGuestMeal</td>
                <td>@bill.TotalMeal</td>
                <td>@bill.MealRate.ToString("0.00")</td>
                <td><strong>@bill.MealAmount.ToString("0.00")</strong></td>
                <td>@bill.HouseBill.ToString("0.00")</td>

                <!-- ELECTRIC BILL : SINGLE ROW -->
                <td>
                    <strong>Total:</strong> @totalCurrentBill.ToString("0.00")
                    |
                    <strong>Member:</strong> @totalMember
                    |
                    <strong>Per Head:</strong>
                    @(totalMember > 0
                        ? (totalCurrentBill / totalMember).ToString("0.00")
                        : "0.00")
                </td>

                <!-- GAS BILL : SINGLE ROW -->
                <td>
                    <strong>Total:</strong> @totalGasBill.ToString("0.00")
                    |
                    <strong>Member:</strong> @totalMember
                    |
                    <strong>Per Head:</strong>
                    @(totalMember > 0
                        ? (totalGasBill / totalMember).ToString("0.00")
                        : "0.00")
                </td>

                <td>@bill.ServantBill.ToString("0.00")</td>
                <td>@bill.OtherBill.ToString("0.00")</td>
                <td>@bill.TotalPaidAmount.ToString("0.00")</td>
                <td class="text-primary fw-bold">
                    @bill.TotalPayable.ToString("0.00")
                </td>
                <td>@bill.NetPayable.ToString("0.00")</td>
                <td>@bill.PaidStatus</td>

                @if (User.IsInRole("Member"))
                {
                    <td>
                        @if (bill.NetPayable != 0)
                        {
                            <a asp-controller="Payment"
                               asp-action="Pay"
                               asp-route-BillId="@bill.Id"
                               asp-route-CycleId="@bill.MealCycleId"
                               class="btn btn-sm btn-success">
                                Pay
                            </a>
                        }
                    </td>
                }
            </tr>
        }
        </tbody>

    </table>
</div>

</body>
</html>
