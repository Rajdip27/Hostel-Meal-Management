@model HostelMealManagement.Application.ViewModel.MealBazarVm

@{
    ViewData["Title"] = Model.Id > 0 ? "Edit Meal Bazar" : "Create Meal Bazar";
    Layout = "~/Views/Shared/_AdminLayout.cshtml";
}
<link href="~/css/mealbazar.css" rel="stylesheet" />
<div class="container-fluid px-4 py-4">

    <h2 class="page-title">@ViewData["Title"]</h2>
    <div class="page-underline"></div>

    <div class="form-wrapper">

        <form asp-action="CreateOrEdit" method="post">
            <input type="hidden" asp-for="Id" />

            <!-- ================= BAZAR DATE ================= -->
            <div class="mb-4">
                <label asp-for="BazarDate" class="form-label"></label>
                <input asp-for="BazarDate" type="date" class="form-control" id="BazarDate" />
            </div>

            <!-- ================= START DATE ================= -->
            <div class="mb-4">
                <label asp-for="StartDate" class="form-label"></label>
                <input asp-for="StartDate" type="date" class="form-control bg-light" id="StartDate" readonly />
            </div>

            <!-- ================= END DATE ================= -->
            <div class="mb-4">
                <label asp-for="EndDate" class="form-label"></label>
                <input asp-for="EndDate" asp-format="{0:yyyy-MM-dd}" type="date" class="form-control" id="EndDate" />
                <small id="dateError" class="text-danger" style="display:none;">
                    End date must be greater than or equal to start date
                </small>
            </div>

            <!-- ================= TOTAL DAYS ================= -->
            <div class="mb-4">
                <label asp-for="TotalDays" class="form-label"></label>
                <input asp-for="TotalDays" class="form-control bg-light" readonly id="TotalDays" />
            </div>

            <!-- ================= MEMBERS ================= -->
            <div class="mb-4">
                <label class="form-label">Member(s)</label>

                <select id="memberSelect" class="form-control">
                    <option value="">-- Select Member --</option>
                    @foreach (var item in ViewBag.Members as List<SelectListItem>)
                    {
                        <option value="@item.Value">@item.Text</option>
                    }
                </select>

                <!-- IMPORTANT: no asp-for -->
                <input type="hidden" id="MemberIds" name="MemberIds" />

                <div id="selectedMembers" class="mt-2"></div>
            </div>


            <!-- ================= ITEMS ================= -->
            <h4 class="section-heading">Bazar Items</h4>

            <table class="table table-bordered" id="itemsTable">
                <thead>
                    <tr>
                        <th>Product</th>
                        <th width="120">Qty</th>
                        <th width="140">Price</th>
                        <th width="140">Total</th>
                        <th width="80">Action</th>
                    </tr>
                </thead>
                <tbody>
                    @for (int i = 0; i < Model.Items.Count; i++)
                    {
                        <tr>
                            <td><input asp-for="Items[@i].ProductName" class="form-control" /></td>
                            <td><input asp-for="Items[@i].Quantity" class="form-control quantity" /></td>
                            <td><input asp-for="Items[@i].Price" class="form-control price" /></td>
                            <td class="item-total">0.00</td>
                            <td><button type="button" class="btn-remove remove-item">Remove</button></td>
                        </tr>
                    }
                </tbody>
            </table>

            <button type="button" class="btn btn-outline-primary btn-sm mt-3" id="addItem">
                Add Item
            </button>

            <!-- ================= TOTAL AMOUNT ================= -->
            <div class="mb-4 mt-4">
                <label asp-for="BazarAmount" class="form-label"></label>
                <input asp-for="BazarAmount" class="form-control bg-light" readonly id="BazarAmount" />
            </div>

            <div class="mb-4 mt-4">
                <label asp-for="Description" class="form-label"></label>
                <textarea asp-for="Description" class="form-control bg-light" rows="4"></textarea>
            </div>

            <!-- ================= ACTIONS ================= -->
            <div class="mt-4">
                <button type="submit" class="btn-save">Save</button>
                <a asp-action="Index" class="btn-cancel">Cancel</a>
            </div>

        </form>
    </div>
</div>

@section Scripts {
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="~/js/mealbazar.js"></script>

    <script>
        window.pageData = {
            isNew: @(Model.Id == 0 ? "true" : "false"),
            members: [
                @foreach (var id in Model.MemberIds)
                {
                        var member = (ViewBag.Members as List<SelectListItem>)
                                .FirstOrDefault(x => x.Value == id.ToString());

                        if (member != null)
                        {
                                <text>{ id: "@id", name: "@member.Text" },</text>
                        }
                }
            ]
        };
    </script>

    
}
